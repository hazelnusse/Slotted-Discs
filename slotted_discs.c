#include "slotted_discs.h"

void initsd(sd_t * p)
{
  int i;

  // Setting model parameters and initial conditions
  p->t = p->x[0] = p->x[1] = p->x[3] = p->x[4] = p->x[5] = 0.0;
  p->ra = p->rb = p->m = p->l = 1.0;
  p->x[2] = asin(p->rb / (p->ra + p->l));
  p->k = p->l / 2.0;
  p->g = 9.81;
  p->alpha = M_PI / 2.0;

  for (i = 0; i < 15; ++i)
    p->T_da[i] = p->T_db[i] = 0.0;

  p->T_da[15] = p->T_db[15] = 1.0;

/* Evaluate constants */
  p->z[129] = p->g*p->m;
  p->z[7] = cos(p->alpha);
  p->z[8] = sin(p->alpha);
  p->z[146] = p->rb*p->z[8];
  p->z[149] = p->rb*p->z[7];

  sdF(0.0, p->x, p->f, p);
  sdOutputs(p);

} // sdinit()

int sdF(double t, const double *x, double *f, void *params)
{
  sd_t * p = (sd_t *) params;
  double q1 = x[0];
  double q2 = x[1];
  double q3 = x[2];
  double u = x[5];
  double q1p, q2p, q3p, q4p, q5p, up, * z = p->z,
         ra = p->ra,
         rb = p->rb,
         k = p->k,
         l = p->l,
         m = p->m,
         Ix = p->Ix,
         Iy = p->Iy,
         Iz = p->Iz;


  z[5] = cos(q3);
  z[3] = cos(q2);
  z[32] = z[5]/z[3];
  z[6] = sin(q3);
  z[31] = z[6]/z[3];
  z[4] = sin(q2);
  z[12] = z[3]*z[5];
  z[23] = z[7]*z[4] + z[8]*z[12];
  z[25] = 1 - pow(z[23],2);
  z[26] = pow(z[25],0.5);
  z[28] = z[23]/z[26];
  z[30] = rb*z[28];
  z[13] = 1 - pow(z[4],2);
  z[14] = pow(z[13],0.5);
  z[15] = 1/z[14];
  z[17] = ra*z[15];
  z[27] = 1/z[26];
  z[29] = rb*z[27];
  z[37] = -l*z[5] - z[8]*z[5]*z[30] - z[3]*(z[17]-z[29]);
  z[9] = z[4]*z[6];
  z[16] = z[4]/z[14];
  z[18] = ra*z[16];
  z[41] = z[9]*z[18] - z[7]*z[9]*z[30] - z[6]*(z[17]-z[29]);
  z[39] = z[9]*(l+z[8]*z[30]);
  z[10] = z[4]*z[5];
  z[40] = z[5]*z[18] - z[7]*z[5]*z[30] - z[10]*(z[17]-z[29]);
  z[20] = z[7]*z[6];
  z[36] = z[6]*z[18] - z[20]*z[30] - z[9]*(z[17]-z[29]);
  z[22] = -z[7]*z[10] - z[8]*z[3];
  z[38] = l*z[3] + z[5]*(z[17]-z[29]) - z[10]*z[18] - z[22]*z[30];
  z[42] = -z[36]*z[39] - z[37]*z[38];
  z[43] = (z[37]*z[41]+z[39]*z[40])/z[42];
  q1p = u*(z[32]+z[31]*z[43]);
  q2p = u*(z[6]-z[5]*z[43]);
  z[44] = (z[36]*z[41]-z[38]*z[40])/z[42];
  z[33] = tan(q2);
  z[35] = z[5]*z[33];
  z[34] = z[6]*z[33];
  q3p = u*(z[44]-z[35]-z[34]*z[43]);
  z[1] = cos(q1);
  q4p = -z[1]*z[3]*z[17]*q3p;
  z[2] = sin(q1);
  q5p = -z[2]*z[3]*z[17]*q3p;
  z[48] = k*z[43];
  z[11] = z[3]*z[6];
  z[47] = -z[18] - k*z[44];
  z[49] = z[18]*z[43];
  z[21] = z[7]*z[3] - z[8]*z[10];
  z[53] = z[21]*z[23];
  z[55] = z[53]/pow(z[25],0.5);
  z[57] = (z[21]*z[26]+z[23]*z[55])/pow(z[26],2);
  z[59] = rb*z[57];
  z[75] = z[8]*z[9]*z[59] + z[11]*(l+z[8]*z[30]);
  z[61] = z[3]*z[4];
  z[62] = z[61]/pow(z[13],0.5);
  z[63] = z[62]/pow(z[14],2);
  z[64] = ra*z[63];
  z[65] = z[55]/pow(z[26],2);
  z[67] = rb*z[65];
  z[71] = (z[3]*z[14]+z[4]*z[62])/pow(z[14],2);
  z[72] = ra*z[71];
  z[82] = z[8]*z[4] - z[7]*z[12];
  z[85] = z[5]*(z[64]-z[67]) - l*z[4] - z[10]*z[72] - z[12]*z[18] - z[22]*
  z[59] - z[30]*z[82];
  z[70] = z[4]*(z[17]-z[29]) - z[8]*z[5]*z[59] - z[3]*(z[64]-z[67]);
  z[80] = z[6]*z[72] - z[20]*z[59] - z[9]*(z[64]-z[67]) - z[11]*(z[17]-z[29]);
  z[86] = -z[36]*z[75] - z[37]*z[85] - z[38]*z[70] - z[39]*z[80];
  z[77] = z[5]*z[72] - z[7]*z[5]*z[59] - z[10]*(z[64]-z[67]) - z[12]*(z[17]-
  z[29]);
  z[73] = z[9]*z[72] + z[11]*z[18] - z[7]*z[9]*z[59] - z[7]*z[11]*z[30] - 
  z[6]*(z[64]-z[67]);
  z[92] = (z[86]*(z[36]*z[41]-z[38]*z[40])+z[42]*(z[38]*z[77]+z[40]*z[85]-
  z[36]*z[73]-z[41]*z[80]))/pow(z[42],2);
  z[94] = u*z[92];
  z[52] = z[8]*z[11];
  z[54] = z[23]*z[52];
  z[56] = z[54]/pow(z[25],0.5);
  z[58] = (z[23]*z[56]+z[26]*z[52])/pow(z[26],2);
  z[60] = rb*z[58];
  z[76] = z[10]*(l+z[8]*z[30]) - z[8]*z[9]*z[60];
  z[66] = z[56]/pow(z[26],2);
  z[68] = rb*z[66];
  z[83] = z[7]*z[9];
  z[84] = z[5]*z[68] + z[9]*z[18] + z[22]*z[60] - z[30]*z[83] - z[6]*(z[17]-
  z[29]);
  z[69] = l*z[6] + z[8]*z[5]*z[60] + z[8]*z[6]*z[30] - z[3]*z[68];
  z[79] = z[7]*z[5];
  z[81] = z[5]*z[18] + z[20]*z[60] - z[9]*z[68] - z[30]*z[79] - z[10]*(z[17]-
  z[29]);
  z[87] = -z[36]*z[76] - z[37]*z[84] - z[38]*z[69] - z[39]*z[81];
  z[78] = z[7]*z[5]*z[60] + z[7]*z[6]*z[30] + z[9]*(z[17]-z[29]) - z[6]*z[18] - 
  z[10]*z[68];
  z[74] = z[10]*z[18] + z[7]*z[9]*z[60] - z[6]*z[68] - z[7]*z[10]*z[30] - 
  z[5]*(z[17]-z[29]);
  z[93] = (z[87]*(z[36]*z[41]-z[38]*z[40])+z[42]*(z[38]*z[78]+z[40]*z[84]-
  z[36]*z[74]-z[41]*z[81]))/pow(z[42],2);
  z[95] = u*z[93];
  z[97] = -z[94]*q2p - z[95]*q3p;
  z[88] = (z[86]*(z[37]*z[41]+z[39]*z[40])-z[42]*(z[37]*z[73]+z[39]*z[77]+
  z[40]*z[75]+z[41]*z[70]))/pow(z[42],2);
  z[90] = u*z[88];
  z[89] = (z[87]*(z[37]*z[41]+z[39]*z[40])-z[42]*(z[37]*z[74]+z[39]*z[78]+
  z[40]*z[76]+z[41]*z[69]))/pow(z[42],2);
  z[91] = u*z[89];
  z[96] = z[90]*q2p + z[91]*q3p;
  z[45] = z[17]*(z[3]*z[44]-z[10]-z[9]*z[43]);
  z[46] = z[17]*(z[6]-z[5]*z[43]);
  z[99] = u*z[46];
  z[103] = z[64]*(z[3]*z[44]-z[10]-z[9]*z[43]) + z[17]*(z[9]*z[88]-z[12]-z[3]*
  z[92]-z[4]*z[44]-z[11]*z[43]);
  z[105] = u*z[103];
  z[104] = z[17]*(z[9]+z[9]*z[89]-z[3]*z[93]-z[10]*z[43]);
  z[106] = u*z[104];
  z[123] = -z[99]*q3p - z[105]*q2p - z[106]*q3p;
  z[100] = u*z[47];
  z[115] = k*z[88];
  z[117] = u*z[115];
  z[116] = k*z[89];
  z[118] = u*z[116];
  z[50] = u*z[43];
  z[102] = u*z[49];
  z[126] = u*z[100] + z[117]*q2p + z[118]*q3p - z[50]*z[102];
  z[101] = u*z[48];
  z[120] = z[18]*z[89];
  z[122] = u*z[120];
  z[51] = u*z[44];
  z[119] = z[43]*z[72] - z[18]*z[88];
  z[121] = u*z[119];
  z[127] = z[50]*z[101] + z[122]*q3p - z[51]*z[100] - z[121]*q2p;
  z[107] = z[5]*z[17]*z[88] + z[64]*(z[6]-z[5]*z[43]);
  z[109] = u*z[107];
  z[108] = z[17]*(z[5]+z[5]*z[89]+z[6]*z[43]);
  z[110] = u*z[108];
  z[98] = u*z[45];
  z[124] = z[109]*q2p + z[110]*q3p - z[98]*q3p;
  z[111] = k*z[92] - z[72];
  z[113] = u*z[111];
  z[112] = k*z[93];
  z[114] = u*z[112];
  z[125] = u*z[101] + z[113]*q2p + z[114]*q3p - z[51]*z[102];
  z[130] = z[129]*(z[4]*z[48]+z[11]*z[47]+z[12]*z[49]) + Iy*z[44]*z[97] - Ix*
  z[43]*z[96] - m*(z[45]*z[123]+z[48]*z[126]+z[49]*z[127]+z[3]*z[48]*z[124]+
  z[5]*z[45]*z[125]+z[6]*z[45]*z[127]+z[6]*z[49]*z[123]+z[10]*z[46]*z[127]-
  z[46]*z[124]-z[47]*z[125]-z[3]*z[46]*z[126]-z[5]*z[47]*z[123]-z[9]*z[46]*
  z[125]-z[9]*z[47]*z[124]-z[10]*z[49]*z[124]);
  z[128] = m*(2*z[3]*z[46]*z[48]+2*z[5]*z[45]*z[47]-pow(z[45],2)-pow(z[46],2)-
  pow(z[47],2)-pow(z[48],2)-pow(z[49],2)-2*z[6]*z[45]*z[49]-2*z[9]*z[46]*
  z[47]-2*z[10]*z[46]*z[49]) - Iz - Ix*pow(z[43],2) - Iy*pow(z[44],2);
  z[131] = z[130]/z[128];
  up = z[131];

/* Update derivative array prior to integration step */
  f[0] = q1p;
  f[1] = q2p;
  f[2] = q3p;
  f[3] = q4p;
  f[4] = q5p;
  f[5] = up;
  return GSL_SUCCESS;
} // sdF()

int sdOutputs(sd_t * p)
{
  double *z = p->z,
         q2p = p->f[1],
         q3p = p->f[2],
         q4 = p->x[3],
         q5 = p->x[4],
         u = p->x[5],
         ra = p->ra,
         rb = p->rb,
         k = p->k,
         l = p->l,
         m = p->m,
         Ix = p->Ix,
         Iy = p->Iy,
         g = p->g;

  z[19] = z[8]*z[6];
  p->ke = 0.5*m*pow((pow(z[98],2)+pow(z[99],2)+pow(z[100],2)+pow(z[101],2)+pow(
  z[102],2)+2*z[6]*z[98]*z[102]+2*z[9]*z[99]*z[100]+2*z[10]*z[99]*z[102]-2*
  z[3]*z[99]*z[101]-2*z[5]*z[98]*z[100]),0.5);
  p->pe = g*m*(z[17]+k*z[12]-z[4]*z[18]);
  z[133] = z[2]*z[3];
  z[134] = z[1]*z[6] + z[2]*z[10];
  z[136] = z[1]*z[3];
  z[137] = z[2]*z[6] - z[1]*z[10];
  z[138] = z[1]*z[19] - z[2]*z[21];
  z[140] = z[1]*z[21] + z[2]*z[19];
  z[142] = z[7]*z[3] - z[8]*z[4]*z[5];
  z[143] = z[142]*(z[26]+pow(z[23],2)/pow(z[25],0.5))/pow(z[26],2);
  z[144] = z[3]*z[4]/(pow(z[13],0.5)*pow(z[14],2));
  z[145] = z[23]*z[142]/(pow(z[25],0.5)*pow(z[26],2));
  z[147] = z[4]*(z[17]-z[29]) - z[146]*z[5]*z[143] - z[3]*(ra*z[144]-rb*
  z[145]);
  z[148] = z[3]*(z[14]+pow(z[4],2)/pow(z[13],0.5))/pow(z[14],2);
  z[150] = ra*z[9]*z[148] + z[3]*z[6]*z[18] - z[149]*z[9]*z[143] - z[7]*z[3]*
  z[6]*z[30] - z[6]*(ra*z[144]-rb*z[145]);
  z[151] = z[146]*z[9]*z[143] + z[3]*z[6]*(l+z[8]*z[30]);
  z[152] = ra*z[5]*z[148] - z[149]*z[5]*z[143] - z[3]*z[5]*(z[17]-z[29]) - 
  z[10]*(ra*z[144]-rb*z[145]);
  z[153] = ra*z[6]*z[148] - rb*z[20]*z[143] - z[3]*z[6]*(z[17]-z[29]) - z[9]*(
  ra*z[144]-rb*z[145]);
  z[154] = z[8]*z[4] - z[7]*z[3]*z[5];
  z[155] = z[5]*(ra*z[144]-rb*z[145]) - l*z[4] - z[30]*z[154] - ra*z[10]*
  z[148] - rb*z[22]*z[143] - z[3]*z[5]*z[18];
  z[156] = -z[36]*z[151] - z[37]*z[155] - z[38]*z[147] - z[39]*z[153];
  z[157] = (z[156]*(z[37]*z[41]+z[39]*z[40])-z[42]*(z[37]*z[150]+z[39]*z[152]+
  z[40]*z[151]+z[41]*z[147]))/pow(z[42],2);
  z[158] = (z[156]*(z[36]*z[41]-z[38]*z[40])+z[42]*(z[38]*z[152]+z[40]*z[155]-
  z[36]*z[150]-z[41]*z[153]))/pow(z[42],2);
  z[159] = k*z[158] - ra*z[148];
  z[160] = ra*z[43]*z[148] - z[18]*z[157];
  z[161] = -z[7]*z[4] - z[8]*z[3]*z[5];
  z[162] = z[21]*z[142] + z[23]*z[161];
  z[163] = (z[25]*z[162]+z[23]*z[53]*z[142])/pow(z[25],1.5);
  z[164] = (z[26]*(z[23]*z[163]+z[26]*z[161]+z[55]*z[142])+z[23]*z[142]*(
  z[21]*z[26]+2*z[23]*z[55])/pow(z[25],0.5))/pow(z[26],3);
  z[165] = z[146]*z[9]*z[164] + z[146]*z[11]*z[143] + z[8]*z[3]*z[6]*z[59] - 
  z[4]*z[6]*(l+z[8]*z[30]);
  z[166] = pow(z[3],2) - pow(z[4],2);
  z[167] = (z[13]*z[166]+z[3]*z[4]*z[61])/pow(z[13],1.5);
  z[168] = (z[14]*z[167]+2*z[3]*z[4]*z[62]/pow(z[13],0.5))/pow(z[14],3);
  z[169] = (z[26]*z[163]+2*z[23]*z[55]*z[142]/pow(z[25],0.5))/pow(z[26],3);
  z[170] = (z[3]*z[4]*(z[3]*z[14]+2*z[4]*z[62])/pow(z[13],0.5)-z[14]*(z[4]*
  z[14]-z[3]*z[62]-z[4]*z[167]))/pow(z[14],3);
  z[171] = z[8]*z[3] + z[7]*z[4]*z[5];
  z[172] = z[4]*z[5]*z[18] + z[5]*(ra*z[168]-rb*z[169]) - l*z[3] - z[30]*
  z[171] - z[59]*z[154] - ra*z[10]*z[170] - ra*z[12]*z[148] - rb*z[22]*z[164] - 
  rb*z[82]*z[143] - z[3]*z[5]*z[72];
  z[173] = z[3]*(z[17]-z[29]) + z[4]*(z[64]-z[67]) + z[4]*(ra*z[144]-rb*
  z[145]) - z[146]*z[5]*z[164] - z[3]*(ra*z[168]-rb*z[169]);
  z[174] = ra*z[6]*z[170] + z[4]*z[6]*(z[17]-z[29]) - rb*z[20]*z[164] - z[3]*
  z[6]*(z[64]-z[67]) - z[9]*(ra*z[168]-rb*z[169]) - z[11]*(ra*z[144]-rb*
  z[145]);
  z[175] = -z[36]*z[165] - z[37]*z[172] - z[38]*z[173] - z[39]*z[174] - z[70]*
  z[155] - z[75]*z[153] - z[80]*z[151] - z[85]*z[147];
  z[176] = ra*z[5]*z[170] + z[4]*z[5]*(z[17]-z[29]) - z[149]*z[5]*z[164] - 
  z[3]*z[5]*(z[64]-z[67]) - z[10]*(ra*z[168]-rb*z[169]) - z[12]*(ra*z[144]-rb*
  z[145]);
  z[177] = ra*z[9]*z[170] + ra*z[11]*z[148] + z[3]*z[6]*z[72] + z[7]*z[4]*
  z[6]*z[30] - z[149]*z[9]*z[164] - z[149]*z[11]*z[143] - z[4]*z[6]*z[18] - 
  z[7]*z[3]*z[6]*z[59] - z[6]*(ra*z[168]-rb*z[169]);
  z[178] = (2*z[86]*z[156]*(z[36]*z[41]-z[38]*z[40])-z[42]*(z[175]*(z[36]*
  z[41]-z[38]*z[40])-z[86]*(z[38]*z[152]+z[40]*z[155]-z[36]*z[150]-z[41]*
  z[153])-z[156]*(z[38]*z[77]+z[40]*z[85]-z[36]*z[73]-z[41]*z[80])-z[42]*(
  z[36]*z[177]+z[41]*z[174]+z[73]*z[153]+z[80]*z[150]-z[38]*z[176]-z[40]*
  z[172]-z[77]*z[155]-z[85]*z[152])))/pow(z[42],3);
  z[179] = z[52]*z[142] - z[8]*z[4]*z[6]*z[23];
  z[180] = (z[25]*z[179]+z[23]*z[54]*z[142])/pow(z[25],1.5);
  z[181] = (z[23]*z[142]*(z[26]*z[52]+2*z[23]*z[56])/pow(z[25],0.5)+z[26]*(
  z[23]*z[180]+z[56]*z[142]-z[8]*z[4]*z[6]*z[26]))/pow(z[26],3);
  z[182] = z[146]*z[10]*z[143] + z[3]*z[5]*(l+z[8]*z[30]) - z[146]*z[9]*
  z[181] - z[8]*z[3]*z[6]*z[60];
  z[183] = (z[26]*z[180]+2*z[23]*z[56]*z[142]/pow(z[25],0.5))/pow(z[26],3);
  z[184] = z[60]*z[154] + ra*z[9]*z[148] + rb*z[5]*z[183] + rb*z[22]*z[181] + 
  z[3]*z[6]*z[18] - rb*z[83]*z[143] - z[7]*z[3]*z[6]*z[30] - z[6]*(ra*z[144]-
  rb*z[145]);
  z[185] = z[4]*z[68] + z[146]*z[5]*z[181] + z[146]*z[6]*z[143] - rb*z[3]*
  z[183];
  z[186] = ra*z[5]*z[148] + rb*z[20]*z[181] - rb*z[9]*z[183] - rb*z[79]*
  z[143] - z[3]*z[6]*z[68] - z[3]*z[5]*(z[17]-z[29]) - z[10]*(ra*z[144]-rb*
  z[145]);
  z[187] = -z[36]*z[182] - z[37]*z[184] - z[38]*z[185] - z[39]*z[186] - z[69]*
  z[155] - z[76]*z[153] - z[81]*z[151] - z[84]*z[147];
  z[188] = z[149]*z[5]*z[181] + z[149]*z[6]*z[143] + z[3]*z[6]*(z[17]-z[29]) + 
  z[9]*(ra*z[144]-rb*z[145]) - ra*z[6]*z[148] - rb*z[10]*z[183] - z[3]*z[5]*
  z[68];
  z[189] = ra*z[10]*z[148] + z[149]*z[9]*z[181] + z[3]*z[5]*z[18] + z[7]*z[3]*
  z[6]*z[60] - rb*z[6]*z[183] - z[149]*z[10]*z[143] - z[7]*z[3]*z[5]*z[30] - 
  z[5]*(ra*z[144]-rb*z[145]);
  z[190] = (2*z[87]*z[156]*(z[36]*z[41]-z[38]*z[40])-z[42]*(z[187]*(z[36]*
  z[41]-z[38]*z[40])-z[87]*(z[38]*z[152]+z[40]*z[155]-z[36]*z[150]-z[41]*
  z[153])-z[156]*(z[38]*z[78]+z[40]*z[84]-z[36]*z[74]-z[41]*z[81])-z[42]*(
  z[36]*z[189]+z[41]*z[186]+z[74]*z[153]+z[81]*z[150]-z[38]*z[188]-z[40]*
  z[184]-z[78]*z[155]-z[84]*z[152])))/pow(z[42],3);
  z[191] = u*(z[34]*z[157]-z[158]-(z[5]+z[6]*z[43])/pow(z[3],2));
  z[192] = u*z[178]*q2p + u*z[190]*q3p - z[95]*z[191] - u*z[5]*z[94]*z[157];
  z[193] = (2*z[86]*z[156]*(z[37]*z[41]+z[39]*z[40])-z[42]*(z[175]*(z[37]*
  z[41]+z[39]*z[40])+z[86]*(z[37]*z[150]+z[39]*z[152]+z[40]*z[151]+z[41]*
  z[147])+z[156]*(z[37]*z[73]+z[39]*z[77]+z[40]*z[75]+z[41]*z[70])-z[42]*(
  z[37]*z[177]+z[39]*z[176]+z[40]*z[165]+z[41]*z[173]+z[70]*z[150]+z[73]*
  z[147]+z[75]*z[152]+z[77]*z[151])))/pow(z[42],3);
  z[194] = (2*z[87]*z[156]*(z[37]*z[41]+z[39]*z[40])-z[42]*(z[187]*(z[37]*
  z[41]+z[39]*z[40])+z[87]*(z[37]*z[150]+z[39]*z[152]+z[40]*z[151]+z[41]*
  z[147])+z[156]*(z[37]*z[74]+z[39]*z[78]+z[40]*z[76]+z[41]*z[69])-z[42]*(
  z[37]*z[189]+z[39]*z[188]+z[40]*z[182]+z[41]*z[185]+z[69]*z[150]+z[74]*
  z[147]+z[76]*z[152]+z[78]*z[151])))/pow(z[42],3);
  z[195] = z[91]*z[191] + u*z[5]*z[90]*z[157] - u*z[193]*q2p - u*z[194]*q3p;
  z[196] = ra*z[144]*(z[3]*z[44]-z[10]-z[9]*z[43]) + z[17]*(z[9]*z[157]-z[3]*
  z[5]-z[3]*z[158]-z[4]*z[44]-z[3]*z[6]*z[43]);
  z[197] = z[5]*z[17]*z[157] + ra*z[144]*(z[6]-z[5]*z[43]);
  z[198] = ra*z[168]*(z[3]*z[44]-z[10]-z[9]*z[43]) + ra*z[144]*(z[9]*z[88]-
  z[12]-z[3]*z[92]-z[4]*z[44]-z[11]*z[43]) + z[64]*(z[9]*z[157]-z[3]*z[5]-
  z[3]*z[158]-z[4]*z[44]-z[3]*z[6]*z[43]) - z[17]*(z[3]*z[44]+z[9]*z[193]-
  z[3]*z[178]-z[4]*z[5]-z[4]*z[92]-z[4]*z[158]-z[11]*z[157]-z[3]*z[6]*z[88]-
  z[4]*z[6]*z[43]);
  z[199] = ra*z[144]*(z[9]+z[9]*z[89]-z[3]*z[93]-z[10]*z[43]) - z[17]*(z[9]*
  z[194]+z[3]*z[5]*z[43]-z[3]*z[6]-z[3]*z[190]-z[4]*z[93]-z[10]*z[157]-z[3]*
  z[6]*z[89]);
  z[200] = -z[99]*z[191] - z[106]*z[191] - u*z[5]*z[105]*z[157] - u*z[197]*
  q3p - u*z[198]*q2p - u*z[199]*q3p;
  z[201] = z[118]*z[191] + u*z[102]*z[157] + pow(u,2)*z[159] + u*z[5]*z[117]*
  z[157] - u*z[50]*z[160] - k*u*z[193]*q2p - k*u*z[194]*q3p;
  z[202] = ra*z[89]*z[148] - z[18]*z[194];
  z[203] = z[18]*z[193] + ra*z[43]*z[170] - z[72]*z[157] - ra*z[88]*z[148];
  z[204] = z[122]*z[191] + u*z[100]*z[158] + u*z[202]*q3p - u*z[51]*z[159] - 
  u*z[101]*z[157] - k*u*z[50]*z[157] - u*z[5]*z[121]*z[157] - u*z[203]*q2p;
  z[205] = z[5]*z[64]*z[157] + ra*z[5]*z[88]*z[144] + ra*z[168]*(z[6]-z[5]*
  z[43]) - z[5]*z[17]*z[193];
  z[206] = ra*z[144]*(z[5]+z[5]*z[89]+z[6]*z[43]) - z[17]*(z[5]*z[194]+z[6]*
  z[157]);
  z[207] = z[110]*z[191] + u*z[5]*z[109]*z[157] + u*z[205]*q2p + u*z[206]*q3p - 
  z[98]*z[191] - u*z[196]*q3p;
  z[208] = -k*z[178] - ra*z[170];
  z[209] = z[114]*z[191] + u*z[102]*z[158] + u*z[5]*z[113]*z[157] + u*z[208]*
  q2p - u*z[51]*z[160] - k*pow(u,2)*z[157] - k*u*z[190]*q3p;
  z[210] = z[129]*(z[3]*z[48]+z[11]*z[159]+z[12]*z[160]-k*z[4]*z[157]-z[4]*
  z[5]*z[49]-z[4]*z[6]*z[47]) + Ix*z[157]*z[96] + Iy*z[44]*z[192] - Ix*z[43]*
  z[195] - Iy*z[158]*z[97] - m*(z[45]*z[200]+z[48]*z[201]+z[49]*z[204]+z[160]*
  z[127]+z[196]*z[123]+z[3]*z[48]*z[207]+z[4]*z[46]*z[126]+z[5]*z[45]*z[209]+
  z[5]*z[196]*z[125]+z[6]*z[45]*z[204]+z[6]*z[49]*z[200]+z[6]*z[160]*z[123]+
  z[6]*z[196]*z[127]+z[10]*z[46]*z[204]+z[10]*z[197]*z[127]+z[3]*z[5]*z[46]*
  z[127]-z[46]*z[207]-z[47]*z[209]-z[159]*z[125]-z[197]*z[124]-k*z[157]*
  z[126]-z[3]*z[46]*z[201]-z[3]*z[197]*z[126]-z[4]*z[48]*z[124]-z[5]*z[47]*
  z[200]-z[5]*z[159]*z[123]-z[9]*z[46]*z[209]-z[9]*z[47]*z[207]-z[9]*z[159]*
  z[124]-z[9]*z[197]*z[125]-z[10]*z[49]*z[207]-z[10]*z[160]*z[124]-k*z[3]*
  z[157]*z[124]-z[3]*z[5]*z[49]*z[124]-z[3]*z[6]*z[46]*z[125]-z[3]*z[6]*z[47]*
  z[124]);
  z[211] = 2*Ix*z[43]*z[157] + 2*Iy*z[44]*z[158] + 2*m*(k*z[48]*z[157]+z[3]*
  z[48]*z[197]+z[5]*z[45]*z[159]+z[5]*z[47]*z[196]-z[45]*z[196]-z[46]*z[197]-
  z[47]*z[159]-z[49]*z[160]-z[4]*z[46]*z[48]-z[6]*z[45]*z[160]-z[6]*z[49]*
  z[196]-z[9]*z[46]*z[159]-z[9]*z[47]*z[197]-z[10]*z[46]*z[160]-z[10]*z[49]*
  z[197]-k*z[3]*z[46]*z[157]-z[3]*z[5]*z[46]*z[49]-z[3]*z[6]*z[46]*z[47]);
  z[212] = (z[128]*z[210]-z[211]*z[130])/pow(z[128],2);
  z[213] = z[44] - z[35] - z[34]*z[43];
  z[214] = -z[95]*z[213] - z[94]*(z[6]-z[5]*z[43]) - z[92]*q2p - z[93]*q3p;
  z[215] = z[91]*z[213] + z[90]*(z[6]-z[5]*z[43]) + z[88]*q2p + z[89]*q3p;
  z[216] = -z[99]*z[213] - z[106]*z[213] - z[105]*(z[6]-z[5]*z[43]) - z[46]*
  q3p - z[103]*q2p - z[104]*q3p;
  z[217] = z[100] + u*z[47] + z[118]*z[213] + z[117]*(z[6]-z[5]*z[43]) + 
  z[115]*q2p + z[116]*q3p - z[43]*z[102] - z[49]*z[50];
  z[218] = z[43]*z[101] + z[48]*z[50] + z[122]*z[213] + z[120]*q3p - z[44]*
  z[100] - z[47]*z[51] - z[121]*(z[6]-z[5]*z[43]) - z[119]*q2p;
  z[219] = z[110]*z[213] + z[109]*(z[6]-z[5]*z[43]) + z[107]*q2p + z[108]*q3p - 
  z[98]*z[213] - z[45]*q3p;
  z[220] = z[101] + u*z[48] + z[114]*z[213] + z[113]*(z[6]-z[5]*z[43]) + 
  z[111]*q2p + z[112]*q3p - z[44]*z[102] - z[49]*z[51];
  z[221] = Iy*z[44]*z[214] - Ix*z[43]*z[215] - m*(z[45]*z[216]+z[48]*z[217]+
  z[49]*z[218]+z[3]*z[48]*z[219]+z[5]*z[45]*z[220]+z[6]*z[45]*z[218]+z[6]*
  z[49]*z[216]+z[10]*z[46]*z[218]-z[46]*z[219]-z[47]*z[220]-z[3]*z[46]*z[217]-
  z[5]*z[47]*z[216]-z[9]*z[46]*z[220]-z[9]*z[47]*z[219]-z[10]*z[49]*z[219]);

  p->A[0] = u*z[5]*z[157];
  p->A[1] = z[6] - z[5]*z[43];
  p->A[2] = z[212];
  p->A[3] = z[221]/z[128];
  p->no_cb[0] = q4 - l*z[134] - z[18]*z[133] - z[30]*z[138];
  p->no_cb[1] = q5 + z[18]*z[136] - l*z[137] - z[30]*z[140];
  p->no_cb[2] = z[29] + z[4]*z[18] - z[17] - l*z[12] - z[23]*z[30];
  return GSL_SUCCESS;
}
